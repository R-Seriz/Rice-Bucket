<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Bucket</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='assets/favicon_io/favicon.ico') }}">
</head>

<body class="no-scroll">

    <div class="navbar">
        <a href="{{ url_for('home') }}" style="text-decoration:none">Home</a>
        <a href="{{ url_for('about') }}" style="text-decoration:none">About</a>
        <a href="{{ url_for('member_feed') }}" style="text-decoration:none">Feed</a>
        <a href="{{ url_for('members') }}" style="text-decoration: none">Members</a>
        <a class="active" href="{{ url_for('upload') }}" style="text-decoration:none">Upload</a>
        <a href="{{ url_for('directory') }}" style="text-decoration:none">Directory</a>
        <div class="nav-right">
            <a href="{{ url_for('logout') }}" style="text-decoration:none">Logout</a>
        </div>
    </div>

    <div class="container">
        <div class="sectionheader">Upload</div>
        <p id="upload-instructions">
            Submission must include a Title, Year (YYYY), and Month (MM) <br>
            Accepted file types: <b>.JPG, .PNG, .MP3, .MP4, YouTube Link</b><br>
            Accepted years: 2022 to present</p>
        <form id="uploader" method=post method=post enctype=multipart/form-data>
            <div class="upload-forms">
                <select id="file-type" name=filetype form="uploader" required>
                    <option value="" disabled selected>Select file type</option>
                    <option value="0">.JPG</option>
                    <option value="1">.PNG</option>
                    <option value="2">.MP3</option>
                    <option value="3">.MP4</option>
                    <option value="4">YouTube Link</option>
                </select>
            </div>
            <div class="upload-forms">
                <input id="title" type=text name=title placeholder="Title">
                <input id="year" type=text name=year placeholder="YYYY" maxlength="4">
                <input id="month" type=text name=month placeholder="MM" maxlength="2">
            </div>
            <div class="upload-forms">
                <textarea id="description" name="description" placeholder="Description" maxlength="500"></textarea>
                <div id="char-count">
                    <span id="char-count-text">0/500</span> characters
                </div>
            </div>
            <div class="upload-forms">
                <div id="file-selector-shadows"></div>
                <input type="file" name="file" />
            </div>
            <div class="upload-forms" id="youtube-link-container" style="display: none;">
                <input id="youtube-link" type="url" name="youtube-link" placeholder="YouTube URL">
            </div>
            <div class="upload-forms">
                <input type=submit value=Upload style="transform: translateX(4px);">
            </div>
        </form>

    </div>
</body>

<style>
    .upload-forms {
        padding: 8px;
    }

    #file-selector-shadows {
        position: absolute;
        pointer-events: none;
        background-color: none;
        height: 20px;
        margin-left: 4px;
        margin-right: 200px;
        width: 95px;
        box-shadow: -2px -2px #e0dede, -2px 0 #e0dede, 0 -2px #e0dede, -4px -4px white, -4px 0 white, 0 -4px white, 2px 2px #818181, 0 2px #818181, 2px 0 #818181, 2px -2px #e0dede, -2px 2px #818181, -4px 2px white, -4px 4px black, 4px 4px black, 4px 0 black, 0 4px black, 2px -4px white, 4px -4px black;
    }

    #title {
        width: 401px;
    }

    #year {
        text-align: center;
        width: 40px;
    }

    #month {
        text-align: center;
        width: 30px;
    }

    #description {
        display: block;
        width: 500px;
        font-family: 'Chicago';
        border-radius: 0;
        border: 1.5px solid #818181;
        resize: none;
        box-sizing: border-box;
    }

    #char-count {
        text-align: right;
        width: 500px;
        font-family: JetBrains Mono, monospace;
        font-size: 14px;
        color: #818181;
        padding-top: 5px;
    }

    #description:focus,
    #title:focus,
    #author:focus,
    #year:focus,
    #month:focus,
    #youtube-link:focus,
    #file-type:focus,
    #uploader input[type="file"]:focus {
        outline: none;
    }

    #uploader {
        display: flex;
        flex-direction: column;
        padding-left: 20px;
    }

    label[for="file-type"] {
        font-family: 'Chicago';
        font-size: 14px;
    }

    #file-type {
        font-family: 'Chicago';
        font-size: 14px;
        box-shadow: -2px -2px #e0dede, -2px 0 #e0dede, 0 -2px #e0dede, -4px -4px white, -4px 0 white, 0 -4px white, 2px 2px #818181, 0 2px #818181, 2px 0 #818181, 2px -2px #e0dede, -2px 2px #818181, -4px 2px white, -4px 4px black, 4px 4px black, 4px 0 black, 0 4px black, 2px -4px white, 4px -4px black;
        border-radius: 0;
        border: none;
        background: none;
        text-align: center;
        width: 125px;
        height: 20px;
        margin-left: 4px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    #uploader input[type="text"] {
        font-family: 'Chicago';
        border-radius: 0;
        border: 1.5px solid #818181;
    }

    #uploader input[type="url"] {
        font-family: 'Chicago';
        border-radius: 0;
        border: 1.5px solid #818181;
        width: 493px;
    }

    #uploader input[type="submit"] {
        font-family: 'Chicago';
        box-shadow: -2px -2px #e0dede, -2px 0 #e0dede, 0 -2px #e0dede, -4px -4px white, -4px 0 white, 0 -4px white, 2px 2px #818181, 0 2px #818181, 2px 0 #818181, 2px -2px #e0dede, -2px 2px #818181, -4px 2px white, -4px 4px black, 4px 4px black, 4px 0 black, 0 4px black, 2px -4px white, 4px -4px black;
        border-radius: 0;
        border: none;
        background: none;
        height: 20px;
    }

    #uploader input[type="file"] {
        font-family: 'Chicago';
        height: 20x;
        margin-left: 5px;
        margin-right: 200px;
        width: 225px;
    }

    #uploader input[type="submit"]:active {
        box-shadow: -2px -2px #818181, -2px 0 #818181, 0 -2px #818181, -4px -4px black, -4px 0 black, 0 -4px black, 2px 2px #e0dede, 0 2px #e0dede, 2px 0 #e0dede, 2px -2px #818181, -2px 2px #e0dede, -4px 2px black, -4px 4px white, 4px 4px white, 4px 0 white, 0 4px white, 2px -4px black, 4px -4px white;
    }

    #upload-instructions {
        font-size: 14px;
        padding-left: 25px;
        font-family: JetBrains Mono, monospace;
        margin-top: 0;
        margin-bottom: 5px;
    }

    input::file-selector-button {
        font-family: 'Chicago';
        border-radius: 0;
        border: none;
        background: none;
        padding-right: 20px;
    }
</style>

<script>
    const description = document.getElementById('description');
    const charCountText = document.getElementById('char-count-text');

    description.style.height = description.scrollHeight + 'px';

    description.addEventListener('input', function () {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
        const maxLength = this.getAttribute('maxlength');
        const currentLength = this.value.length;
        charCountText.textContent = `${currentLength}/${maxLength}`;
    });

    const form = document.getElementById('uploader');
    const fileInput = document.querySelector('input[name="file"]');
    const titleInput = document.getElementById('title');
    const yearInput = document.getElementById('year');
    const monthInput = document.getElementById('month');

    form.addEventListener('submit', function (event) {
        let isValid = true;

        const selectedType = fileTypeDropdown.value;

        // Validate based on selected file type
        if (selectedType === '4') {
            if (!youtubeInput.value.trim() || !/^https:\/\/(www\.)?youtube\.com\/watch\?v=/.test(youtubeInput.value)) {
                isValid = false;
                alert('PLEASE ENTER A VALID YOUTUBE LINK');
            }
        } else {
            if (!fileInput.files.length) {
                isValid = false;
                alert('PLEASE SELECT A FILE');
            }
        }

        if (!titleInput.value.trim()) {
            isValid = false;
            alert('PLEASE ENTER A TITLE');
        }

        if (!/^\d{4}$/.test(yearInput.value)) {
            isValid = false;
            alert('PLEASE ENTER A VALID 4-DIGIT YEAR');
        }

        if (!/^(0[1-9]|1[0-2])$/.test(monthInput.value)) {
            isValid = false;
            alert('PLEASE ENTER A VALID MONTH (01-12)');
        }

        if (!isValid) {
            event.preventDefault();
        }
    });

    const fileTypeDropdown = document.getElementById('file-type');
    const fileUploadInput = document.querySelector('input[name="file"]');
    const youtubeContainer = document.getElementById('youtube-link-container');
    const youtubeInput = document.getElementById('youtube-link');

    fileTypeDropdown.addEventListener('change', function () {
        if (this.value === '4') {
            fileUploadInput.disabled = true;
            fileUploadInput.parentElement.style.display = 'none';
            youtubeContainer.style.display = 'block';
        } else {
            fileUploadInput.disabled = false;
            fileUploadInput.parentElement.style.display = 'block';
            youtubeContainer.style.display = 'none';
            youtubeInput.value = ''; // Clear if switching back
        }
    });


</script>

</html>